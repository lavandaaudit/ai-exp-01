<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IBONARIUM · SOLAR TENSION · PROBE</title>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#04060a;
  font-family: monospace;
  color:#9fb3ff;
}

/* ЗОНД */
#probe{
  position:fixed;
  top:12px;
  left:12px;
  width:380px;
}

/* ТЕКСТ */
#text{
  font-size:11px;
  line-height:1.4;
  opacity:0.65;
  margin-bottom:6px;
}

/* АНІМАЦІЯ 1 — ПРИЧИНА */
#cause{
  height:36px;
  overflow:hidden;
  margin-bottom:6px;
}

.line{
  height:1px;
  margin:6px 0;
  background:linear-gradient(90deg, transparent, #7aa2ff, transparent);
  transform-origin:left;
  opacity:0.55;
}

/* АНІМАЦІЯ 2 — НАСЛІДОК */
#effect{
  height:110px;
}

canvas{
  width:100%;
  height:100%;
  display:block;
}
</style>
</head>

<body>

<div id="probe">

  <!-- ТЕКСТ -->
  <div id="text">
    IBONARIUM · SOLAR TENSION<br>
    Long observation experiment.<br>
    Real solar processes deform the field<br>
    without being shown.<br>
    Until 13 December.
  </div>

  <!-- ПРИЧИНА -->
  <div id="cause">
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
  </div>

  <!-- НАСЛІДОК -->
  <div id="effect">
    <canvas id="cosmos"></canvas>
  </div>

</div>

<script>
/* CANVAS */
const canvas = document.getElementById("cosmos");
const ctx = canvas.getContext("2d");
let w,h;
function resize(){
  w = canvas.width = canvas.clientWidth;
  h = canvas.height = canvas.clientHeight;
}
resize();

/* СТАН СОНЦЯ */
let solar = {
  wind: 320,
  xray: 1,
  f107: 75
};

/* ЧАСТИНКИ */
const parts=[];
for(let i=0;i<110;i++){
  parts.push({
    a: Math.random()*Math.PI*2,
    r: Math.random()*42+8,
    v: Math.random()*0.18+0.04
  });
}

let time=0;

/* НАСЛІДОК */
function render(){
  time += 0.002*(1+solar.xray);

  ctx.fillStyle="rgba(4,6,10,0.22)";
  ctx.fillRect(0,0,w,h);

  ctx.save();
  ctx.translate(w/2,h/2);

  parts.forEach(p=>{
    p.a += p.v*(solar.wind/500);
    const rr = p.r*(1+solar.xray*0.18);
    const x = Math.cos(p.a+time)*rr;
    const y = Math.sin(p.a+time)*rr;

    ctx.fillStyle = `rgba(${100+solar.f107},${70},${180},0.65)`;
    ctx.fillRect(x,y,1.1,1.1);
  });

  ctx.restore();
  requestAnimationFrame(render);
}
render();

/* ПРИЧИНА */
const lines = document.querySelectorAll(".line");
function deform(){
  lines.forEach(l=>{
    const scale = 1 + (solar.wind/1100) + solar.xray*0.28;
    const rot = (solar.f107-70)/30;
    l.style.transform = `scaleX(${scale}) rotate(${rot}deg)`;
  });
}
setInterval(deform,3200);

/* NOAA DATA */
fetch("https://services.swpc.noaa.gov/products/solar-wind/plasma-7-day.json")
.then(r=>r.json())
.then(d=>{
  const last=d[d.length-1];
  solar.wind=parseFloat(last[2])||solar.wind;
});

fetch("https://services.swpc.noaa.gov/json/goes/primary/xrays-1-day.json")
.then(r=>r.json())
.then(d=>{
  const last=d[d.length-1];
  solar.xray=Math.min(parseFloat(last.flux)||1,5);
});

fetch("https://services.swpc.noaa.gov/json/f107_cm_flux.json")
.then(r=>r.json())
.then(d=>{
  const last=d[d.length-1];
  solar.f107=parseFloat(last.flux)||solar.f107;
});
</script>

</body>
</html>
