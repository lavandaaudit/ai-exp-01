<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IBONARIUM · SOLAR TENSION · COMPACT</title>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#04060a;
  font-family: monospace;
  color:#9fb3ff;
}

/* ЛАБОРАТОРНИЙ БЛОК */
#lab{
  position:fixed;
  top:12px;
  left:12px;
  width:420px;
  height:260px;
  border:1px solid rgba(120,150,255,0.2);
  background:rgba(6,8,14,0.85);
  padding:10px;
  box-sizing:border-box;
}

/* АНІМАЦІЯ 1 — ПРИЧИНА */
#cause{
  height:40px;
  overflow:hidden;
}

.line{
  height:1px;
  margin:6px 0;
  background:linear-gradient(90deg, transparent, #7aa2ff, transparent);
  transform-origin:left;
  opacity:0.6;
}

/* АНІМАЦІЯ 2 — НАСЛІДОК */
#effect{
  margin-top:8px;
  height:120px;
  border:1px solid rgba(120,150,255,0.15);
}

canvas{
  width:100%;
  height:100%;
  display:block;
}

/* ТЕКСТ */
#text{
  margin-top:8px;
  font-size:10px;
  line-height:1.35;
  opacity:0.7;
}
</style>
</head>

<body>

<div id="lab">

  <!-- ПРИЧИНА -->
  <div id="cause">
    <div class="line"></div>
    <div class="line"></div>
    <div class="line"></div>
  </div>

  <!-- НАСЛІДОК -->
  <div id="effect">
    <canvas id="cosmos"></canvas>
  </div>

  <!-- ОПИС -->
  <div id="text">
    IBONARIUM · SOLAR TENSION<br>
    Довготривалий експеримент спостереження.<br>
    Реальні сонячні процеси впливають на поле,<br>
    не будучи показаними напряму.<br>
    <br>
    Період спостереження — до 13 грудня.
  </div>

</div>

<script>
/* CANVAS */
const canvas = document.getElementById("cosmos");
const ctx = canvas.getContext("2d");
let w,h;
function resize(){
  w = canvas.width = canvas.clientWidth;
  h = canvas.height = canvas.clientHeight;
}
resize();

/* СТАН СОНЦЯ */
let solar = {
  wind: 320,
  xray: 1,
  f107: 75
};

/* ЧАСТИНКИ */
const parts=[];
for(let i=0;i<120;i++){
  parts.push({
    a: Math.random()*Math.PI*2,
    r: Math.random()*40+10,
    v: Math.random()*0.2+0.05
  });
}

let time=0;

/* НАСЛІДОК */
function render(){
  time += 0.002*(1+solar.xray);

  ctx.fillStyle="rgba(6,8,14,0.25)";
  ctx.fillRect(0,0,w,h);

  ctx.save();
  ctx.translate(w/2,h/2);

  parts.forEach(p=>{
    p.a += p.v*(solar.wind/450);
    const rr = p.r*(1+solar.xray*0.2);
    const x = Math.cos(p.a+time)*rr;
    const y = Math.sin(p.a+time)*rr;

    ctx.fillStyle = `rgba(${100+solar.f107},${70},${180},0.7)`;
    ctx.fillRect(x,y,1.2,1.2);
  });

  ctx.restore();
  requestAnimationFrame(render);
}
render();

/* ПРИЧИНА */
const lines = document.querySelectorAll(".line");
function deform(){
  lines.forEach(l=>{
    const scale = 1 + (solar.wind/1000) + solar.xray*0.3;
    const rot = (solar.f107-70)/25;
    l.style.transform = `scaleX(${scale}) rotate(${rot}deg)`;
  });
}
setInterval(deform,3000);

/* NOAA */
/* Сонячний вітер */
fetch("https://services.swpc.noaa.gov/products/solar-wind/plasma-7-day.json")
.then(r=>r.json())
.then(d=>{
  const last=d[d.length-1];
  solar.wind=parseFloat(last[2])||solar.wind;
});

/* X-ray */
fetch("https://services.swpc.noaa.gov/json/goes/primary/xrays-1-day.json")
.then(r=>r.json())
.then(d=>{
  const last=d[d.length-1];
  solar.xray=Math.min(parseFloat(last.flux)||1,5);
});

/* F10.7 */
fetch("https://services.swpc.noaa.gov/json/f107_cm_flux.json")
.then(r=>r.json())
.then(d=>{
  const last=d[d.length-1];
  solar.f107=parseFloat(last.flux)||solar.f107;
});
</script>

</body>
</html>
